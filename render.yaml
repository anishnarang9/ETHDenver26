# Render Blueprint - ETHDenver26 TripDesk Stack
# Deploy: Push to GitHub, then https://dashboard.render.com/blueprints → New Blueprint Instance
# All services share the same env group for secrets.

databases:
  - name: kite-db
    plan: free
    databaseName: kite_stack
    user: kite

envVarGroups:
  - name: kite-shared-env
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: FIRECRAWL_API_KEY
        sync: false
      - key: AGENTMAIL_API_KEY
        sync: false
      - key: KITE_RPC_URL
        value: https://rpc-testnet.gokite.ai/
      - key: PASSPORT_REGISTRY_ADDRESS
        value: "0x6c01C9815e747Ebdf86C0a75eEA93463e5e83626"
      - key: SESSION_REGISTRY_ADDRESS
        value: "0x3da599e5D01B8d3B90bC95eD65bf7fE6A5DEFb15"
      - key: RECEIPT_LOG_ADDRESS
        value: "0x1bD859eC8B91DB23Ae9d443339Ef5A6514a17c84"
      - key: GATEWAY_SIGNER_PRIVATE_KEY
        sync: false
      - key: DEPLOYER_PRIVATE_KEY
        sync: false
      - key: PAYMENT_RECIPIENT
        value: "0xcEd9b7174adc57C6d0ceB3E921a9c7e658C175A7"
      - key: PAYMENT_ASSET
        value: "0x0fF5393387ad2f9f691FD6Fd28e07E3969e27e63"
      - key: FACILITATOR_URL
        value: https://facilitator.pieverse.io
      - key: AGENT_PRIVATE_KEY
        sync: false
      - key: PLANNER_AGENT_PRIVATE_KEY
        sync: false
      - key: PLANNER_SESSION_PRIVATE_KEY
        sync: false
      - key: PLANNER_PAYMENT_PRIVATE_KEY
        sync: false

services:
  # ── Gateway (existing) ─────────────────────────────
  - type: web
    name: kite-gateway
    runtime: node
    plan: free
    buildCommand: npm install -g pnpm@9.12.2 && pnpm install && pnpm --filter @kite-stack/shared-types build && pnpm --filter @kite-stack/provider-kit build && pnpm --filter @kite-stack/db build && pnpm db:generate && pnpm --filter @kite-stack/gateway build
    startCommand: node apps/gateway/dist/server.js
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kite-db
          property: connectionString
      - key: GATEWAY_PORT
        value: "10000"
      - key: GATEWAY_HOST
        value: "0.0.0.0"
      - key: ROUTE_POLICY_PROFILE
        value: test
      - key: TEST_PRICE_ENRICH_ATOMIC
        value: "1000"
      - key: TEST_PRICE_PREMIUM_ATOMIC
        value: "5000"
      - key: MAX_KITE_SPEND_PER_DAY
        value: "0.05"
      - key: NODE_ENV
        value: production
      - fromGroup: kite-shared-env

  # ── Rider Agent ─────────────────────────────────────
  - type: web
    name: kite-rider
    runtime: node
    plan: free
    buildCommand: npm install -g pnpm@9.12.2 && pnpm install && pnpm --filter @kite-stack/shared-types build && pnpm --filter @kite-stack/provider-kit build && pnpm --filter @kite-stack/agent-core build && pnpm --filter @kite-stack/rider build
    startCommand: node apps/rider/dist/index.js
    envVars:
      - key: PORT
        value: "10000"
      - key: HOST
        value: "0.0.0.0"
      - key: NODE_ENV
        value: production
      - fromGroup: kite-shared-env

  # ── Foodie Agent ────────────────────────────────────
  - type: web
    name: kite-foodie
    runtime: node
    plan: free
    buildCommand: npm install -g pnpm@9.12.2 && pnpm install && pnpm --filter @kite-stack/shared-types build && pnpm --filter @kite-stack/provider-kit build && pnpm --filter @kite-stack/agent-core build && pnpm --filter @kite-stack/foodie build
    startCommand: node apps/foodie/dist/index.js
    envVars:
      - key: PORT
        value: "10000"
      - key: HOST
        value: "0.0.0.0"
      - key: NODE_ENV
        value: production
      - fromGroup: kite-shared-env

  # ── EventBot Agent ──────────────────────────────────
  - type: web
    name: kite-eventbot
    runtime: node
    plan: free
    buildCommand: npm install -g pnpm@9.12.2 && pnpm install && pnpm --filter @kite-stack/shared-types build && pnpm --filter @kite-stack/provider-kit build && pnpm --filter @kite-stack/agent-core build && pnpm --filter @kite-stack/eventbot build
    startCommand: node apps/eventbot/dist/index.js
    envVars:
      - key: PORT
        value: "10000"
      - key: HOST
        value: "0.0.0.0"
      - key: NODE_ENV
        value: production
      - fromGroup: kite-shared-env

  # ── Planner Orchestrator ────────────────────────────
  - type: web
    name: kite-planner
    runtime: node
    plan: free
    buildCommand: npm install -g pnpm@9.12.2 && pnpm install && pnpm --filter @kite-stack/shared-types build && pnpm --filter @kite-stack/agent-core build && pnpm --filter @kite-stack/db build && pnpm db:generate && pnpm --filter @kite-stack/planner build
    startCommand: node apps/planner/dist/index.js
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kite-db
          property: connectionString
      - key: PORT
        value: "10000"
      - key: HOST
        value: "0.0.0.0"
      - key: RIDER_URL
        fromService:
          type: web
          name: kite-rider
          property: hostport
      - key: FOODIE_URL
        fromService:
          type: web
          name: kite-foodie
          property: hostport
      - key: EVENTBOT_URL
        fromService:
          type: web
          name: kite-eventbot
          property: hostport
      - key: KITE_WEATHER_URL
        value: https://x402.dev.gokite.ai
      - key: NODE_ENV
        value: production
      - fromGroup: kite-shared-env
